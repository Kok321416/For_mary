# Деплой сайта на reg.ru через GitHub Actions

## 1. Создать репозиторий на GitHub и запушить проект

1. Зайдите на [github.com](https://github.com), войдите в аккаунт.
2. Нажмите **«+» → «New repository»**.
3. Укажите имя (например, `for-mary` или `psychologist-site`), выберите **Public**.
4. **Не** ставьте галочки «Add README» / «Add .gitignore» — репозиторий должен быть пустым.
5. Нажмите **«Create repository»**.
6. В папке проекта выполните (подставьте свой логин и имя репозитория):

```bash
cd c:\Users\Artem\PycharmProjects\FOR_MARY

git remote add origin https://github.com/ВАШ_ЛОГИН/ИМЯ_РЕПОЗИТОРИЯ.git
git branch -M main
git push -u origin main
```

Либо, если используете SSH:

```bash
git remote add origin git@github.com:ВАШ_ЛОГИН/ИМЯ_РЕПОЗИТОРИЯ.git
git branch -M main
git push -u origin main
```

Репозиторий станет открытым (Public), если вы так выбрали при создании.

---

## 2. Данные FTP на reg.ru

На хостинге reg.ru:

1. Зайдите в [панель управления](https://www.reg.ru/user/authorize) → ваш хостинг.
2. Откройте раздел **«FTP»** или **«Файловый менеджер»** и найдите:
   - **FTP-сервер** (например, `ваш-логин.ftp.tools.reg.ru` или IP).
   - **Логин** и **пароль** FTP (часто совпадают с логином/паролем панели или отдельные для FTP).
3. Узнайте **путь к корню сайта** на сервере. Обычно это:
   - `public_html` или
   - `www` или
   - `htdocs`
   Путь указывается **относительно входа по FTP** (например, `public_html` или `/public_html`).

---

## 3. Секреты в GitHub

1. Откройте репозиторий на GitHub → вкладка **«Settings»** → слева **«Secrets and variables» → «Actions»**.
2. Нажмите **«New repository secret»** и по очереди создайте:

| Name             | Value (пример)                          |
|------------------|------------------------------------------|
| `FTP_HOST`       | `ваш-логин.ftp.tools.reg.ru` или IP     |
| `FTP_USER`       | Ваш FTP-логин                           |
| `FTP_PASSWORD`   | Ваш FTP-пароль                          |
| `FTP_REMOTE_PATH`| `public_html` или `www` (корень сайта)   |

Значения берите из панели reg.ru (FTP).

---

## 4. Деплой

- При каждом **push в ветку `main`** GitHub Actions автоматически зальёт файлы на хостинг по FTP.
- Запуск вручную: в репозитории вкладка **«Actions»** → workflow **«Deploy to reg.ru»** → **«Run workflow»**.

Проверка: откройте ваш домен (например, `https://ваш-домен.ru`) — должна открыться главная страница сайта.

### 4.1. Диагностика: почему сайт не открывается, хотя деплой прошёл

После каждого деплоя в том же запуске workflow выполняется шаг **«Diagnostics — check site response»**. Он запрашивает ваш домен и выводит в лог:

- **HTTP-код ответа** (200, 404, 403, редирект и т.д.);
- **Заголовки ответа** сервера;
- **Начало тела страницы** (первые ~1200 символов).

**Где смотреть:** GitHub → репозиторий → вкладка **Actions** → последний запуск **Deploy to reg.ru** → шаг **Diagnostics — check site response**.

По выводу можно понять: сервер отдаёт вашу HTML-страницу (код 200 и в теле виден ваш контент), страницу «не найдено» (404), ошибку доступа (403) или редирект. Если видите 404/403 при успешном деплое — значит домен не привязан к папке с файлами в панели reg.ru (раздел **Сайты** → корневая директория).

Домен для проверки по умолчанию: **https://egorovamariyapsy.ru**. Чтобы проверять другой URL, в **Settings → Secrets → Actions** создайте секрет **SITE_URL** со значением, например, `https://другой-домен.ru`.

---

## 5. Если сайт открывается не из той папки

В reg.ru в настройках хостинга (раздел «Сайты» / «Домены») проверьте **корневую директорию** для домена. Она должна совпадать с тем, что указано в `FTP_REMOTE_PATH` (например, `public_html`). При необходимости измените `FTP_REMOTE_PATH` в секретах и заново запустите workflow.

---

## 5.1. «Страница не найдена» и ошибка dnserror (файлы на хостинге есть)

Если деплой прошёл, файлы на сервере есть, но при открытии домена (например, **egorovamariyapsy.ru**) показывается «Страница не найдена» и **dnserror**, значит проблема в настройке домена и DNS.

**Что сделать в личном кабинете reg.ru:**

1. **Привязать домен к хостингу**
   - Зайдите в [личный кабинет reg.ru](https://www.reg.ru/user/authorize).
   - Услуга **Хостинг** → ваш тариф → раздел **«Сайты»** или **«Домены»** / **«Управление сайтами»**.
   - Убедитесь, что домен **egorovamariyapsy.ru** **добавлен** в список сайтов хостинга (кнопка «Добавить сайт» / «Привязать домен»). Без привязки сервер не знает, какой сайт показывать по этому адресу.

2. **Указать корневую папку для домена**
   - В настройках сайта для **egorovamariyapsy.ru** задайте **корневую директорию** (каталог сайта): та же папка, куда идёт деплой — обычно **`public_html`** или **`www`** (как в секрете `FTP_REMOTE_PATH`).

3. **Проверить DNS домена**
   - В кабинете reg.ru откройте услугу **Домен** → **egorovamariyapsy.ru** → **Управление зоной DNS** / **DNS-серверы**.
   - Если домен на хостинге reg.ru: должны быть прописаны **NS reg.ru** (например, `ns1.reg.ru`, `ns2.reg.ru`) или **А-запись** на IP вашего хостинга (IP смотрите в разделе хостинга «Доступы» / «Информация о сервере»).
   - Если домен куплен у другого регистратора: в зоне DNS у регистратора добавьте **А-запись** для `@` (и при необходимости для `www`) на **IP-адрес сервера хостинга reg.ru** (узнать в панели хостинга).

4. **Подождать обновления DNS**
   - После смены DNS или привязки домена изменения могут применяться от нескольких минут до 24–48 часов. Через некоторое время проверьте снова: `http://egorovamariyapsy.ru/` и `https://egorovamariyapsy.ru/`.

Итог: файлы уже на сервере; нужно, чтобы домен был **привязан к хостингу** и **корневая папка** совпадала с папкой деплоя, а DNS домена указывал на сервер reg.ru.

---

## 6. Ошибка «530 Login incorrect»

Ошибка значит: **логин или пароль FTP не приняты сервером**. Что сделать:

1. **Проверьте данные в панели reg.ru**
   - Зайдите в [личный кабинет](https://www.reg.ru/user/authorize) → ваш хостинг.
   - Раздел **«Доступы»** / **«FTP»** (или «Файловый менеджер» → сведения о FTP).
   - Посмотрите **точный логин** и при необходимости **сбросьте пароль FTP**.

2. **Формат логина на reg.ru**
   - Основной аккаунт: обычно вид **`u1234567`** (логин услуги хостинга).
   - Доп. FTP-пользователь: **`u1234567_имя`** (основной логин + подчёркивание + имя).
   - В секрет **FTP_USER** вставляйте **ровно то**, что указано в панели (без пробелов в начале/конце).

3. **Пароль**
   - В reg.ru пароль FTP: минимум 6 символов, латиница, цифры и спецсимволы (`!@#$%&?_`).
   - В GitHub: **Settings → Secrets and variables → Actions** → откройте **FTP_PASSWORD** → **Update**.
   - Вставьте пароль **без лишних пробелов** и кавычек. Спецсимволы вводить можно.

4. **Обновите секреты**
   - После смены пароля в reg.ru обязательно обновите **FTP_PASSWORD** в GitHub (и при необходимости **FTP_USER**).
   - Запустите workflow заново: **Actions → Deploy to reg.ru → Run workflow**.

Если хостинг поддерживает только **SFTP** (а не FTP), эта action не подойдёт — тогда нужен другой workflow на SFTP.

---

## 7. Важно

- Не коммитьте пароли в репозиторий — только в **Secrets**.
- Файлы `.git`, `.github`, `.idea`, `.venv` и служебные файлы на хостинг **не** заливаются (настроено в workflow).
